buildscript {
  repositories {
      maven { url "http://dl.bintray.com/calmdev/gradle-plugins" }
      mavenLocal()
      jcenter()
  }

  dependencies {
    classpath 'me.champeau.gradle:jbake-gradle-plugin:0.2.1-SNAPSHOT'
    classpath 'org.akhikhl.gretty:gretty:+'
    classpath 'org.hidetake:gradle-ssh-plugin:1.0.1'
  }
}

apply plugin: 'me.champeau.jbake'
apply plugin: 'distribution'
apply from: 'gradle/environment.gradle'
apply plugin: 'distribution'


repositories {
  mavenLocal()
  jcenter()
}


if ( env == "local" ){
  apply plugin: 'war'
  apply plugin: 'org.akhikhl.gretty'

  gretty {
    httpPort = config.server.port
    contextPath = config.server.contextPath
  }
}
else {
  apply from: 'gradle/publish.gradle'
}

jbake{
  version = "2.4.0"
  asciidoctorjVersion = "1.5.2"
  configuration['render.tags'] = true
  configuration['site.host'] = config.server.url
  configuration['site.contextPath'] = config.server.contextPath
  configuration['foundation.version'] = "5.5.1"
}

distributions {
  main {
    contents {
      from { bake.outputs }
    }
  }
}

task copyBaked(type: Copy, dependsOn: 'bake'){
  from "$buildDir/jbake"
  into "$buildDir/inplaceWebapp"
}

distZip.dependsOn bake

task copyBaked(type: Copy, dependsOn: bake){
  from bake.output
  into "$buildDir/inplaceWebapp"
}
